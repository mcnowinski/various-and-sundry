#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

source $DIR/utils

#check parameters
if [ $# -ne 2 ]; then
	echo "This routine obtains bias calibration frames"
    echo "Usage: bloop <number of frames> <binning>"
    exit 1
fi

NUM_BIAS=$1
BINNING=$2
EXPOSURE_SEC=0.1
COUNT=0

#not really necessary, but why not
pfilter clear

#get bias frames
alert "Taking $NUM_BIAS bias frames (bin=$BINNING, time=$EXPOSURE_SEC)..."

#check ccd status before starting
checkCCDTemp
for (( i=1; i<=$NUM_BIAS; i++ ))
do
  getImage $EXPOSURE_SEC $BINNING `date -u +"%Y%m%d.%H%M%S%3N"`.`printf "%03d" $COUNT`.bias.$BINNING.$EXPOSURE_SEC.fits dark 0
  if [ $SUCCESS -eq 1 ]
  then
	COUNT=$((COUNT+1))
  fi
done

alert "Bias frame sequence complete. Obtained $COUNT bias frames."