#!/bin/bash

source slack.conf

# Usage: slackalert "<message>"
if [ $# -ne 1 ]; then
    echo usage: slackalert "<message>"
    exit 1
fi

text=$1

#if [[ $text == "" ]]
#then
#        echo "Error. No message specified."
#        exit 1
#fi

escapedText=$(echo $text | sed 's/"/\"/g' | sed "s/'/\'/g" )

json="{\"channel\": \"$slackalert_channel\", \"username\":\"$slackalert_username\", \"icon_emoji\":\"ghost\", \"attachments\":[{\"color\":\"danger\" , \"text\": \"$escapedText\"}]}"

curl -s -d "payload=$json" "$slackalert_webhook_url" > /dev/null 2>&1